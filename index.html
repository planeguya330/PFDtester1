<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>A320 Simulation - Realistic</title>
    <style>
        /* --- 1. General Styles --- */
        body {
            background-color: #1a1a1a;
            color: #ddd;
            font-family: 'Consolas', 'Courier New', monospace; /* Monospace for technical look */
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
            user-select: none; /* Prevent text selection while dragging */
            overflow: hidden;
        }

        .cockpit-container {
            display: flex;
            gap: 20px;
            padding: 20px;
            background-color: #2b2b2b;
            border-radius: 15px;
            box-shadow: inset 0 0 50px rgba(0,0,0,0.5);
            border-top: 5px solid #444;
        }

        /* --- 2. Display Units (Screens) --- */
        .screen-frame {
            width: 380px;
            height: 380px;
            background-color: #000;
            border: 12px solid #555;
            border-radius: 20px;
            box-shadow: 0 0 20px rgba(0,0,0,0.8);
            position: relative;
            overflow: hidden;
        }

        /* Shine reflection on screens */
        .screen-frame::after {
            content: "";
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: linear-gradient(135deg, rgba(255,255,255,0.05) 0%, rgba(255,255,255,0) 40%);
            pointer-events: none;
            z-index: 100;
        }

        /* --- 3. Primary Flight Display (PFD) --- */
        #pfd { position: relative; }

        /* Sky and Ground */
        .pfd-horizon {
            position: absolute;
            top: 50%; left: 50%;
            width: 600px; height: 600px;
            background: linear-gradient(to bottom, #36719E 50%, #844C21 50%);
            transform-origin: center;
            transition: transform 0.05s linear; /* Fast update for smoothness */
            will-change: transform;
        }

        /* Pitch Ladder (White lines) */
        .pitch-ladder {
            position: absolute;
            top: 50%; left: 50%;
            width: 100%; height: 100%;
            transform: translate(-50%, -50%);
        }
        .pitch-line {
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            background-color: white;
            height: 2px;
        }
        /* 10 degrees = 60px roughly in this scale */
        .pl-10 { top: calc(50% - 60px); width: 60px; }
        .pl-20 { top: calc(50% - 120px); width: 100px; }
        .pl-n10 { top: calc(50% + 60px); width: 60px; }
        .pl-n20 { top: calc(50% + 120px); width: 100px; }
        
        .pitch-line::after {
            content: attr(data-val);
            position: absolute;
            right: -25px; top: -7px;
            font-size: 12px; color: white;
        }

        /* Bank Indicator (Top Triangle) */
        .bank-pointer {
            position: absolute;
            top: 15px; left: 50%;
            width: 0; height: 0;
            border-left: 10px solid transparent;
            border-right: 10px solid transparent;
            border-bottom: 15px solid yellow;
            transform: translateX(-50%);
            z-index: 10;
        }
        
        .bank-scale-arc {
            position: absolute;
            top: 30px; left: 50%;
            width: 260px; height: 260px;
            border-radius: 50%;
            border-top: 3px solid white;
            transform: translateX(-50%);
            clip-path: polygon(0 0, 100% 0, 100% 30%, 0 30%); /* Only show top arc */
        }

        /* The Aircraft Symbol (Fixed Black/Yellow Wing) */
        .aircraft-symbol {
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            width: 140px; height: 10px;
            z-index: 20;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .ac-wing {
            width: 40px; height: 4px; background: #000; border: 2px solid #FFD700;
        }
        .ac-dot {
            width: 8px; height: 8px; background: #000; border: 2px solid #FFD700; border-radius: 50%;
        }

        /* Speed & Alt Tapes */
        .tape-container {
            position: absolute;
            top: 10%; bottom: 10%;
            width: 50px;
            background: rgba(0,0,0,0.4);
            overflow: hidden;
            border: 1px solid white;
            z-index: 30;
        }
        .speed-tape { left: 0; border-left: none; }
        .alt-tape { right: 0; border-right: none; }

        .tape-slider {
            position: absolute;
            left: 0; width: 100%;
            transition: transform 0.1s linear;
        }
        .tape-mark {
            height: 40px; /* Space between ticks */
            border-bottom: 1px solid white;
            text-align: right;
            padding-right: 2px;
            font-size: 12px;
            color: white;
            box-sizing: border-box;
        }
        .current-val-box {
            position: absolute;
            top: 50%;
            height: 30px; width: 65px;
            background: #000;
            border: 2px solid yellow;
            color: greenyellow;
            font-size: 18px;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            transform: translateY(-50%);
            z-index: 35;
        }
        .cv-speed { left: 0; }
        .cv-alt { right: 0; }

        /* --- 4. Navigation Display (ND) --- */
        #nd {
            background-color: #000;
            color: #0f0; /* Radar Green */
        }

        .nd-compass-rose {
            position: absolute;
            top: 55%; left: 50%;
            width: 300px; height: 300px;
            border: 2px solid white;
            border-radius: 50%;
            transform: translate(-50%, -50%);
            display: flex;
            align-items: center;
            justify-content: center;
            box-sizing: border-box;
        }
        
        /* The Moving Map Container */
        .nd-map-layer {
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            overflow: hidden;
            clip-path: circle(42% at 50% 55%); /* Clip map inside the compass rose */
        }

        .waypoint {
            position: absolute;
            width: 10px; height: 10px;
            background: transparent;
            border: 2px solid magenta;
            transform: translate(-50%, -50%);
            color: magenta;
            font-size: 12px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .waypoint span { margin-top: 12px; font-weight: bold; white-space: nowrap;}

        .nd-plane-icon {
            position: absolute;
            top: 55%; left: 50%;
            transform: translate(-50%, -50%);
            font-size: 30px;
            color: yellow;
            z-index: 50;
            text-shadow: 0 0 5px black;
        }

        /* Top Text Info */
        .nd-info {
            position: absolute;
            top: 10px;
            width: 100%;
            display: flex;
            justify-content: space-between;
            padding: 0 20px;
            box-sizing: border-box;
            font-size: 18px;
            font-weight: bold;
            color: greenyellow;
        }

        .heading-box {
            position: absolute;
            top: 15%; left: 50%;
            transform: translateX(-50%);
            color: white;
            font-size: 20px;
            background: #000;
            padding: 2px 5px;
            border: 1px solid white;
            z-index: 60;
        }

        /* --- 5. Joystick Controls --- */
        .controls-area {
            margin-top: 30px;
            text-align: center;
        }

        .joystick-base {
            width: 150px;
            height: 150px;
            background: radial-gradient(circle at 50% 50%, #444, #222);
            border-radius: 50%;
            border: 5px solid #555;
            position: relative;
            margin: 0 auto;
            touch-action: none; /* Crucial for mobile drag */
        }

        .joystick-stick {
            width: 60px;
            height: 60px;
            background: radial-gradient(circle at 30% 30%, #666, #111);
            border-radius: 50%;
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            cursor: pointer;
            box-shadow: 0 5px 15px rgba(0,0,0,0.5);
            border: 2px solid #000;
        }

        .instructions {
            margin-top: 15px;
            font-size: 14px;
            color: #888;
        }

    </style>
</head>
<body>

    <div class="cockpit-container">
        
        <div id="pfd" class="screen-frame">
            <div class="pfd-horizon" id="horizon">
                <div class="pitch-ladder">
                    <div class="pitch-line pl-20" data-val="20"></div>
                    <div class="pitch-line pl-10" data-val="10"></div>
                    <div class="pitch-line" style="width: 300px; top: 50%;"></div>
                    <div class="pitch-line pl-n10" data-val="10"></div>
                    <div class="pitch-line pl-n20" data-val="20"></div>
                </div>
            </div>

            <div class="bank-scale-arc"></div>
            <div class="bank-pointer" id="bank-pointer"></div>

            <div class="aircraft-symbol">
                <div class="ac-wing"></div>
                <div class="ac-dot"></div>
                <div class="ac-wing"></div>
            </div>

            <div class="tape-container speed-tape">
                <div class="tape-slider" id="speed-tape-slider">
                    </div>
            </div>
            <div class="current-val-box cv-speed">180</div>

            <div class="tape-container alt-tape">
                <div class="tape-slider" id="alt-tape-slider">
                    </div>
            </div>
            <div class="current-val-box cv-alt" id="alt-text">000</div>
        </div>

        <div id="nd" class="screen-frame">
            <div class="nd-info">
                <span id="gs-text">GS 180</span>
                <span id="tas-text">TAS 180</span>
            </div>
            
            <div class="heading-box" id="heading-text">000°</div>

            <div class="nd-compass-rose">
                <div style="position: absolute; top: 5px; color: white; font-weight: bold;">N</div>
                <div style="position: absolute; bottom: 5px; color: white; font-weight: bold;">S</div>
                <div style="position: absolute; left: 10px; color: white; font-weight: bold;">W</div>
                <div style="position: absolute; right: 10px; color: white; font-weight: bold;">E</div>
            </div>

            <div class="nd-map-layer" id="map-layer">
                </div>

            <div class="nd-plane-icon">✈</div>
        </div>
    </div>

    <div class="controls-area">
        <div class="joystick-base" id="joystick-base">
            <div class="joystick-stick" id="joystick-stick"></div>
        </div>
        <div class="instructions">DRAG JOYSTICK TO FLY</div>
    </div>

    <script>
        /* --- CONFIGURATION --- */
        const SPEED_KNOTS = 180;
        const TURN_RATE_FACTOR = 0.05; // How fast heading changes based on bank
        const PITCH_SENSITIVITY = 0.1;
        const BANK_SENSITIVITY = 0.1;
        const MAX_BANK = 30;
        const MAX_PITCH = 20;

        /* --- STATE --- */
        let state = {
            pitch: 0,
            bank: 0,
            heading: 0, // 0-360
            altitude: 0,
            posX: 0, // World X coordinate
            posY: 0, // World Y coordinate (North is -Y)
            joystick: { x: 0, y: 0 } // -1 to 1
        };

        // Waypoints (World Coordinates)
        // Let's place them ahead of the start position (0,0)
        const waypoints = [
            { id: 'WPT1', x: 0, y: -2000, label: 'ALPHA' },
            { id: 'WPT2', x: 1000, y: -5000, label: 'BRAVO' },
            { id: 'WPT3', x: -1000, y: -8000, label: 'CHARLIE' },
            { id: 'VOR1', x: 2000, y: -3000, label: 'LIS' },
            { id: 'FIX1', x: 0, y: -12000, label: 'FINAL' }
        ];

        /* --- DOM ELEMENTS --- */
        const els = {
            horizon: document.getElementById('horizon'),
            bankPointer: document.getElementById('bank-pointer'),
            altText: document.getElementById('alt-text'),
            headingText: document.getElementById('heading-text'),
            mapLayer: document.getElementById('map-layer'),
            stick: document.getElementById('joystick-stick'),
            base: document.getElementById('joystick-base'),
            altSlider: document.getElementById('alt-tape-slider'),
            speedSlider: document.getElementById('speed-tape-slider')
        };

        /* --- INITIALIZATION --- */
        function init() {
            // Generate Tape Lines
            createTapeMarks(els.altSlider, -1000, 5000, 100);
            createTapeMarks(els.speedSlider, 100, 300, 10);
            
            // Create Waypoint Elements
            waypoints.forEach(wp => {
                const el = document.createElement('div');
                el.className = 'waypoint';
                el.id = `wp-${wp.id}`;
                el.innerHTML = `<span>${wp.label}</span>`;
                els.mapLayer.appendChild(el);
            });

            // Start Loop
            requestAnimationFrame(gameLoop);
        }

        function createTapeMarks(container, min, max, step) {
            // Simple visual fill - just enough div lines to look realistic
            // In a full app, we would virtualize this list.
            for(let i = max; i >= min; i -= step) {
                const div = document.createElement('div');
                div.className = 'tape-mark';
                div.innerText = i;
                container.appendChild(div);
            }
        }

        /* --- JOYSTICK LOGIC --- */
        let dragging = false;
        const stickRadius = 35; // Half of stick width + border
        const maxDist = 40; // Max drag distance

        function handleStart(e) { dragging = true; }
        function handleEnd(e) { 
            dragging = false; 
            state.joystick.x = 0; 
            state.joystick.y = 0; 
            updateStickVisual();
        }
        function handleMove(e) {
            if (!dragging) return;
            e.preventDefault(); // Prevent scroll on touch

            const rect = els.base.getBoundingClientRect();
            const centerX = rect.left + rect.width / 2;
            const centerY = rect.top + rect.height / 2;
            
            const clientX = e.touches ? e.touches[0].clientX : e.clientX;
            const clientY = e.touches ? e.touches[0].clientY : e.clientY;

            let dx = clientX - centerX;
            let dy = clientY - centerY;
            
            const dist = Math.sqrt(dx*dx + dy*dy);
            
            // Clamp distance
            if (dist > maxDist) {
                dx = (dx / dist) * maxDist;
                dy = (dy / dist) * maxDist;
            }

            state.joystick.x = dx / maxDist; // -1 to 1
            state.joystick.y = dy / maxDist; // -1 to 1
            
            updateStickVisual(dx, dy);
        }

        function updateStickVisual(dx = 0, dy = 0) {
            els.stick.style.transform = `translate(calc(-50% + ${dx}px), calc(-50% + ${dy}px))`;
        }

        // Event Listeners for Joystick
        els.stick.addEventListener('mousedown', handleStart);
        window.addEventListener('mouseup', handleEnd);
        window.addEventListener('mousemove', handleMove);

        els.stick.addEventListener('touchstart', handleStart);
        window.addEventListener('touchend', handleEnd);
        window.addEventListener('touchmove', handleMove);


        /* --- GAME LOOP --- */
        function gameLoop() {
            updatePhysics();
            renderPFD();
            renderND();
            requestAnimationFrame(gameLoop);
        }

        function updatePhysics() {
            // Update Pitch/Bank based on Joystick target
            // Smoothly interpolate towards target
            const targetBank = state.joystick.x * MAX_BANK;
            const targetPitch = state.joystick.y * -MAX_PITCH; // Up stick (-Y) = Positive Pitch

            state.bank += (targetBank - state.bank) * 0.1;
            state.pitch += (targetPitch - state.pitch) * 0.1;

            // Turn Plane (Simple flight model)
            // Banking causes heading change
            if (Math.abs(state.bank) > 1) {
                state.heading += state.bank * TURN_RATE_FACTOR;
                // Normalize Heading 0-360
                if (state.heading >= 360) state.heading -= 360;
                if (state.heading < 0) state.heading += 360;
            }

            // Change Altitude based on Pitch
            // Simple: 1 degree pitch = +/- 5 ft per frame roughly
            const altChange = state.pitch * 0.5; 
            state.altitude += altChange;
            if (state.altitude < 0) state.altitude = 0; // Ground floor

            // Move Plane in World
            // Convert Heading to Radians (0 deg is North/Up which is -Y in 2D space)
            // Math.sin/cos expect standard trig angle (0 is Right/+X).
            // So: North (0 deg) -> -Y. East (90 deg) -> +X.
            const rad = (state.heading - 90) * (Math.PI / 180);
            
            // Velocity components
            const vx = Math.cos(rad) * (SPEED_KNOTS / 60); // Arbitrary scaling for simulation
            const vy = Math.sin(rad) * (SPEED_KNOTS / 60);

            state.posX += vx;
            state.posY += vy;
        }

        /* --- RENDERING --- */
        function renderPFD() {
            // 1. Horizon & Pitch
            // 10 degrees pitch = approx 60px shift
            const pitchPx = state.pitch * 6; 
            els.horizon.style.transform = `translate(-50%, calc(-50% + ${pitchPx}px)) rotate(${-state.bank}deg)`;
            
            // 2. Bank Pointer
            els.bankPointer.style.transform = `translateX(-50%) rotate(${state.bank}deg)`;

            // 3. Altitude Text
            els.altText.innerText = Math.floor(state.altitude).toString().padStart(3, '0');

            // 4. Alt Tape Slider
            // Move slider. 100ft = 40px height roughly.
            // Center is current alt.
            // We need to shift the tape so the current alt number is in the black box.
            // Let's approximate: 40px per 100ft.
            const altOffset = (state.altitude / 100) * 40;
            // Base offset to align 5000 (max) with top? No, let's just align relative.
            // This is a visual hack for the prototype.
            // A clearer way: translate Y based on modulo to infinite scroll, but we have static limits.
            // Just shifting the whole tape:
            els.altSlider.style.transform = `translateY(${altOffset}px)`;
        }

        function renderND() {
            // 1. Heading Text
            els.headingText.innerText = Math.round(state.heading).toString().padStart(3, '0') + "°";

            // 2. Map Rotation (Compass Rose)
            // The map layer rotates opposite to heading so North stays North
            // els.mapLayer.style.transform = `rotate(${-state.heading}deg)`; 
            // Actually, usually the plane is fixed up, and the world rotates.
            // So we rotate the *points* or the container.
            
            // Let's render waypoints relative to plane
            waypoints.forEach(wp => {
                const el = document.getElementById(`wp-${wp.id}`);
                
                // Relative position in world pixels
                let dx = wp.x - state.posX;
                let dy = wp.y - state.posY;

                // Rotate this relative vector by -Heading to orient it to the screen
                // (Screen Up is Plane Forward)
                const rad = (state.heading) * (Math.PI / 180);
                const screenX = dx * Math.cos(rad) - dy * Math.sin(rad);
                const screenY = dx * Math.sin(rad) + dy * Math.cos(rad);

                // Map Scale (zoom)
                const scale = 0.15; 
                
                // HTML coordinates (Center of ND is 0,0 for these calcs)
                // ND size is 300x300, center is 150,150.
                const finalX = 150 + (screenX * scale);
                const finalY = 150 - (screenY * scale); // Invert Y because screen Y is down

                el.style.left = `${finalX}px`;
                el.style.top = `${finalY}px`;
                
                // Rotate waypoint label to stay upright? 
                // Or let it rotate with map. Usually text stays upright.
                // el.style.transform = `translate(-50%, -50%) rotate(${state.heading}deg)`;
            });
        }

        // Run
        init();

    </script>
</body>
</html>
